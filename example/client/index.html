<!DOCTYPE html>
<html>
  <head>
    <title>Autoupdater Example</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <output id="output">..</output>
    <script>
      const AutoUpdater = require( "nw-autoupdater" ),
            updater = new AutoUpdater( require( "./package.json" ) ),
            output =  document.querySelector( "#output" );

      async function main(){
        try {
          // Update copy is running to replace app with the update
          if ( updater.isSwapRequest() ) {
            output.innerHTML = `Swapping...`;
            await updater.swap();
            output.innerHTML = `Done...`;
            await updater.restart();
            return;
          }
          // Subscribe for progress events
          updater.on( "download", ( downloadSize, totalSize ) => {
            output.innerHTML = `Downloading...`;
            console.log( "download progress", Math.floor( downloadSize / totalSize * 100 ), "%" );
          });
          updater.on( "install", ( installFiles, totalFiles ) => {
            output.innerHTML = `Installing...\n`;
            console.log( "install progress", Math.floor( installFiles / totalFiles * 100 ), "%" );
          });
          // Download/unpack update if any available
          const rManifest = await updater.readRemoteManifest();
          const needsUpdate = await updater.checkNewVersion( rManifest );
          if ( !needsUpdate ) {
            return;
          }
          if ( !confirm( "New release is available. do you want to upgrade?" ) ) {
            return;
          }
          const updateFile = await updater.download( rManifest );
          await updater.unpack( updateFile );
          await updater.restartToSwap();
        } catch ( e ) {
          console.error( e );
        }
      }

      output.innerHTML = `Application ver. ${nw.App.manifest.version}\n`;

      main();

    </script>
  </body>
</html>
