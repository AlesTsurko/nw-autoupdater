<!DOCTYPE html>
<html>
  <head>
    <title>Autoupdater Example</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <div id="output">..</div>
    <label id="label"></label>
    <progress id="progress" value="0" max="100"></progress>
    <script>
      const AutoUpdater = require( "nw-autoupdater" ),
            updater = new AutoUpdater( require( "./package.json" ) );

      async function main(){
        try {
          // Update copy is running to replace app with the update
          if ( updater.isSwapRequest() ) {
            await updater.swap();
            await updater.restart();
            return;
          }
          // Subscribe for progress events
          updater.on( "download", ( downloadSize, totalSize ) => {
            const percent = Math.floor( downloadSize / totalSize * 100 );
            console.log( `download progress ${percent} %` );
            document.getElementById( "label" ).innerHTML = "Downloading...";
            document.getElementById( "progress" ).value = percent;
          });
          updater.on( "install", ( installFiles, totalFiles ) => {
            const percent = Math.floor( installFiles / totalFiles * 100 );
            console.log( `install progress ${percent} %` );
            document.getElementById( "label" ).innerHTML = "Installing...";
            document.getElementById( "progress" ).value = percent;
          });

          // Download/unpack update if any available
          const rManifest = await updater.readRemoteManifest();
          const needsUpdate = await updater.checkNewVersion( rManifest );
          if ( !needsUpdate ) {
            return;
          }
          if ( !confirm( "New release is available. do you want to upgrade?" ) ) {
            return;
          }
          const updateFile = await updater.download( rManifest );
          await updater.unpack( updateFile );
          await updater.restartToSwap();
        } catch ( e ) {
          console.error( e );
        }
      }
      main();

      document.querySelector( "#output" ).innerHTML = `Application ver. ${nw.App.manifest.version}`;

    </script>
  </body>
</html>
